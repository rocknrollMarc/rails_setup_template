#!/bin/sh

# Create user (if apt).
if [ `sudo -u postgres psql postgres -tAc "SELECT 1 FROM pg_roles WHERE rolname='<%= postgresql_user %>'"` ]; then
	echo "User detected, skipping."
else
	echo "User not found, creating..."
	sudo -u postgres psql -c "create user <%= postgresql_user %> with password '<%= postgresql_password %>';"
fi

# Create database for user (if apt).
if [ `sudo -u postgres psql postgres -tAc "SELECT 1 FROM pg_database WHERE datname='<%= postgresql_database %>'"` ]; then
	echo "Database detected, skipping."
else
	echo "Database not found, creating..."
	sudo -u postgres psql -c "create database <%= postgresql_database %> owner <%= postgresql_user %>;"
fi
